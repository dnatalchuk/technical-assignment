<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Event Feed</title>
    <style>
      #events {
        border: 1px solid #ccc;
        height: 200px;
        overflow-y: scroll;
        padding: 5px;
      }
      .highlight {
        background-color: #ffffcc;
        transition: background-color 1s ease;
      }
    </style>
  </head>
  <body>
    <label
      >Tenant:
      <select id="tenant">
        <option value="tenantA">Tenant A</option>
        <option value="tenantB">Tenant B</option>
      </select>
    </label>
    <button id="connect">Connect</button>
    <div id="status"></div>
    <ul id="events"></ul>
    <form id="eventForm">
      <input type="text" id="message" placeholder="message" required />
      <button type="submit">Send</button>
    </form>
    <script>
      let ws;
      let tenant;
      const MAX_EVENTS = 100;
      const eventsList = document.getElementById("events");

      document.getElementById("connect").onclick = () => {
        tenant = document.getElementById("tenant").value;
        ws = new WebSocket(`ws://${location.host}/ws?tenant=` + tenant);
        ws.onmessage = (e) => {
          const ev = JSON.parse(e.data);
          const li = document.createElement("li");
          li.textContent = `${ev.timestamp} - ${ev.message}`;
          li.classList.add("highlight");
          eventsList.appendChild(li);
          setTimeout(() => li.classList.remove("highlight"), 1000);
          eventsList.scrollTop = eventsList.scrollHeight;
          if (eventsList.children.length > MAX_EVENTS) {
            eventsList.removeChild(eventsList.firstChild);
          }
        };
        ws.onopen = () => {
          document.getElementById("status").textContent = "connected";
        };
        ws.onclose = () => {
          document.getElementById("status").textContent = "closed";
        };
      };

      document.getElementById("eventForm").onsubmit = (e) => {
        e.preventDefault();
        const message = document.getElementById("message").value;
        fetch("/events", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-Tenant-ID": tenant,
          },
          body: JSON.stringify({ message }),
        });
        document.getElementById("message").value = "";
      };
    </script>
  </body>
</html>
